<!DOCTYPE html>
<html>
<head>
    <title>Telemetría Vehículo</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
        .container { display: flex; flex-wrap: wrap; gap: 20px; max-width: 1200px; margin: 0 auto; }
        .panel { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); flex: 1 1 300px; min-width: 250px; }
        h2 { border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 0; }
        
        /* Estilos de los contenedores de colores */
        .gauge-panel { text-align: center; }
        .gauge-panel h3 { margin: 5px 0; }
        .gauge-panel .value { font-size: 2.5em; font-weight: bold; margin-bottom: 10px; padding: 10px; border-radius: 6px; color: white; }
        
        /* Colores de estado */
        .color-green { background-color: #4CAF50; } /* Normal */
        .color-orange { background-color: #FF9800; } /* Advertencia / Límite */
        .color-red { background-color: #F44336; } /* Peligro / Reserva */

        /* Estilo de la Notificación de Reserva */
        #reserva-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(244, 67, 54, 0.95); /* Rojo semi-transparente */
            color: white;
            padding: 40px 60px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            font-size: 3em;
            font-weight: bold;
            text-align: center;
            z-index: 1000;
            display: none; /* Inicialmente oculto */
            animation: pulse 1s infinite alternate;
        }

        @keyframes pulse {
            from { transform: translate(-50%, -50%) scale(1); opacity: 0.95; }
            to { transform: translate(-50%, -50%) scale(1.05); opacity: 1; }
        }

        /* Estilos para ocultar la pestaña de Coordenadas */
        .coord-hidden { display: none; }

    </style>
</head>
<body>

    <div id="reserva-notification">¡RESERVA DE COMBUSTIBLE ACTIVA!</div>

    <div class="container">
        
        <div class="panel" style="flex: 1 1 200px;">
            <h2>Estado de Conexión</h2>
            <p><strong>Última Actualización:</strong> <span id="last_update">Cargando...</span></p>
            <p><strong>Estado:</strong> <span id="connection_status">Desconectado</span></p>
        </div>

        <div class="panel" style="flex: 3 1 700px; display: flex; flex-wrap: wrap; gap: 15px;">
            <h2>Medidas del Vehículo</h2>
            
            <div id="temp_agua_gauge" class="gauge-panel">
                <h3>Temperatura Agua (°C)</h3>
                <div id="temp_agua_value" class="value color-green">--</div>
            </div>

            <div id="temp_aceite_gauge" class="gauge-panel">
                <h3>Temperatura Aceite (°C)</h3>
                <div id="temp_aceite_value" class="value color-green">--</div>
            </div>

            <div id="combustible_gauge" class="gauge-panel">
                <h3>Combustible (%)</h3>
                <div id="combustible_value" class="value color-green">--</div>
            </div>

            <div id="bateria_gauge" class="gauge-panel">
                <h3>Batería (V)</h3>
                <div id="bateria_value" class="value color-green">--</div>
            </div>

            <div class="gauge-panel">
                <h3>Velocidad (Km/h)</h3>
                <div class="value" style="background-color: #3f51b5;">
                    <span id="velocidad_value">--</span>
                </div>
            </div>

            <div class="gauge-panel">
                <h3>RPM</h3>
                <div class="value" style="background-color: #00bcd4;">
                    <span id="rpm_value">--</span>
                </div>
            </div>

        </div>

        <div class="panel coord-hidden">
            <h2>Ubicación GPS</h2>
            <p>Latitud: <span id="latitude">--</span></p>
            <p>Longitud: <span id="longitude">--</span></p>
        </div>
        
    </div>

    <script>
        // --- UMBRALES DE COLOR (Valores de ejemplo) ---
        const UMBRALES = {
            temp_agua: { normal: 80, warning: 95, danger: 105 }, // (°C)
            temp_aceite: { normal: 90, warning: 115, danger: 125 }, // (°C)
            combustible: { normal: 25, warning: 15, danger: 10 }, // (%) - IMPORTANTE: PELIGRO es el valor más bajo (RESERVA)
            bateria: { normal_min: 12.5, normal_max: 14.8, warning_min: 11.8, warning_max: 15.2, danger_low: 11.5, danger_high: 15.5 } // (V)
        };

        /**
         * Asigna el color de fondo a un elemento basado en el valor y los umbrales.
         * @param {HTMLElement} element - El elemento div que contiene el valor.
         * @param {number} value - El valor actual de la métrica.
         * @param {string} metricKey - La clave de la métrica en la constante UMBRALES.
         */
        function updateColor(element, value, metricKey) {
            // Limpia todas las clases de color
            element.classList.remove('color-green', 'color-orange', 'color-red');

            const umbral = UMBRALES[metricKey];
            let colorClass = 'color-green'; // Por defecto, es verde

            if (metricKey === 'bateria') {
                // Lógica especial para la batería (rango)
                if (value < umbral.danger_low || value > umbral.danger_high) {
                    colorClass = 'color-red';
                } else if (value < umbral.warning_min || value > umbral.warning_max) {
                    colorClass = 'color-orange';
                } else {
                    colorClass = 'color-green';
                }
            } else if (metricKey === 'combustible') {
                // Lógica de reserva (peligro en el valor más bajo)
                if (value <= umbral.danger) {
                    colorClass = 'color-red';
                    document.getElementById('reserva-notification').style.display = 'block';
                } else if (value <= umbral.warning) {
                    colorClass = 'color-orange';
                    document.getElementById('reserva-notification').style.display = 'none'; // Ocultar si está en advertencia
                } else {
                    colorClass = 'color-green';
                    document.getElementById('reserva-notification').style.display = 'none';
                }
            } else {
                // Lógica general (peligro en el valor más alto)
                if (value >= umbral.danger) {
                    colorClass = 'color-red';
                } else if (value >= umbral.warning) {
                    colorClass = 'color-orange';
                } else {
                    colorClass = 'color-green';
                }
            }

            element.classList.add(colorClass);
        }

        // --- FUNCIÓN DE EJEMPLO PARA RECIBIR DATOS (Simulación) ---
        function updateTelemetry(data) {
            // Actualiza la hora de la última actualización
            document.getElementById('last_update').innerText = new Date().toLocaleTimeString();
            document.getElementById('connection_status').innerText = 'Conectado';
            document.getElementById('connection_status').style.color = '#4CAF50';

            // 1. Actualización de Valores
            document.getElementById('temp_agua_value').innerText = data.temp_agua.toFixed(1);
            document.getElementById('temp_aceite_value').innerText = data.temp_aceite.toFixed(1);
            document.getElementById('combustible_value').innerText = data.combustible.toFixed(0);
            document.getElementById('bateria_value').innerText = data.bateria.toFixed(2);
            document.getElementById('velocidad_value').innerText = data.velocidad.toFixed(0);
            document.getElementById('rpm_value').innerText = data.rpm.toFixed(0);
            
            // 2. Aplicación de Colores y Notificación de Reserva
            updateColor(document.getElementById('temp_agua_value'), data.temp_agua, 'temp_agua');
            updateColor(document.getElementById('temp_aceite_value'), data.temp_aceite, 'temp_aceite');
            updateColor(document.getElementById('combustible_value'), data.combustible, 'combustible');
            updateColor(document.getElementById('bateria_value'), data.bateria, 'bateria');
            
            // 3. Coordenadas (No se actualizan, la pestaña está oculta)
        }

        // --- SIMULACIÓN DE DATOS (Para ver los colores y la reserva) ---
        let simulationValue = 90;
        let fuelValue = 50;
        let batteryValue = 13.5;

        setInterval(() => {
            // Simula cambio de temperatura y nivel de combustible
            simulationValue += (Math.random() - 0.5) * 5; 
            if (simulationValue > 110) simulationValue = 110;
            if (simulationValue < 80) simulationValue = 80;

            fuelValue -= 1; // El combustible baja lentamente
            if (fuelValue < 0) fuelValue = 50;

            batteryValue += (Math.random() - 0.5) * 0.1;
            if (batteryValue > 15.8) batteryValue = 15.8;
            if (batteryValue < 11.0) batteryValue = 11.0;


            const simulatedData = {
                temp_agua: simulationValue,      // Cambiará de color
                temp_aceite: simulationValue - 5, // Similar a la del agua
                combustible: fuelValue,          // Para probar la reserva (< 10)
                bateria: batteryValue,           // Para probar el rango de voltaje
                velocidad: Math.random() * 120,
                rpm: Math.random() * 5000
            };

            updateTelemetry(simulatedData);
        }, 3000); // Actualiza cada 3 segundos

        // Inicia la simulación inmediatamente
        updateTelemetry({ temp_agua: 90, temp_aceite: 85, combustible: 50, bateria: 13.5, velocidad: 0, rpm: 0 });
    </script>

</body>
</html>
